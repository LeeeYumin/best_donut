<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.users.mapper.UsersMapper">

	<select id="getUsers" resultType="UsersVO">
		SELECT u.USERS_CODE
	          , u.USERS_NAME
	          , u.POSITION
	          , u.LOCAL_TEL
	          , u.USERS_STATUS
	          , SUM(DECODE(p.PERM_CODE, 'PER00001', 1)) AS PERM1
	          , SUM(DECODE(p.PERM_CODE, 'PER00002', 1)) AS PERM2
	          , SUM(DECODE(p.PERM_CODE, 'PER00003', 1)) AS PERM3
	          , SUM(DECODE(p.PERM_CODE, 'PER00004', 1)) AS PERM4
	          , SUM(DECODE(p.PERM_CODE, 'PER00005', 1)) AS PERM5
		FROM USERS u JOIN USERS_PERM p
		ON u.USERS_CODE = p.USERS_CODE
		<include refid="condition"></include>
		GROUP BY u.USERS_CODE
		        , u.USERS_NAME
		        , u.POSITION
		        , u.LOCAL_TEL
		        , u.USERS_STATUS
		ORDER BY 1
	</select>
	
	<sql id="condition">
		<where>
			<if test="keyword != null and keyword != ''">
				(u.USERS_CODE LIKE '%' || UPPER(#{keyword}) || '%'			
				OR u.USERS_NAME LIKE '%' ||  UPPER(#{keyword}) || '%')
			</if>
 			<if test="permList != null and permList.size() > 0">
				AND PERM_CODE IN
					<foreach collection="permList" item="perm" open="(" close=")" separator=",">
						#{perm}
					</foreach>
			</if>
			<if test="status != null and status != ''">
				AND USERS_STATUS = #{status}
			</if>
		</where>
	</sql>

</mapper>