<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.production.mapper.ProdPlanMapper">

<!-- 생산요청 -->
	<select id="getProdReq" resultType="ProdPlanBVO">
		SELECT req_date 
		     , prod_req_code
		     , total_req_cnt
		     , users_code
		FROM prod_req
		WHERE req_date BETWEEN SYSDATE - 8 AND SYSDATE
	</select>

<!-- 생산요청상세 -->	
	<select id="getProdReqDetail" resultType="ProdPlanDeVO">
		SELECT prod_req_code
		     , prod_req_detail_code
		     , product_code
		     , req_cnt
		FROM prod_req_detail
		WHERE prod_req_code = #{prodReqCode}
	</select>
	
	
<!-- 생산계획 -->
	<select id="getProdPlan" resultType="ProdPlanVO">
		SELECT prod_plan_code
     		 , prod_req_code
     		 , plan_date
     		 , prod_plan_status
     		 , users_code
		FROM prod_plan
	</select>

	<select id="getProdPlanAll" resultType="ProdPlanAllVO" parameterType="String">
		SELECT d.prod_plan_detail_code
		     , p.prod_plan_code
		     , d.prod_req_detail_code
		     , d.product_code
		     , d.fix_cnt
		     , d.req_cnt
		     , d.plan_cnt
		     , d.not_instruct_cnt
		     , d.instruct_done_cnt
		FROM prod_plan p JOIN prod_plan_detail d
		                    ON p.prod_plan_code = d.prod_plan_code
		WHERE p.prod_plan_code = #{prodPlanCode}
	</select>

	
<!-- 	<insert id="insertProdPlan" parameterType="ProdPlanVO">
		 <selectKey keyProperty="pplnCd" resultType="String" order="BEFORE">
			SELECT prod_plan FROM dual
		 </selectKey>
		INSERT INTO prod_plan
			( prod_plan_code
     		 , prod_req_code
     		 , plan_date
     		 , all_plan_status
     		 , users_code 
     		 )
		VALUES 
			( #{donut.nextval('PPL')}
			, #{prodPlanCode}
			, #{prodReqCode}
			, #{planDate}
			, #{allPlanStatus}
			, #{usersCode}
			)
	</insert> -->
	<insert id="insertProdPlan" parameterType="ProdPlanVO">
		INSERT INTO prod_plan
			( prod_plan_code
     		 , prod_req_code
     		 , plan_date
     		 , prod_plan_status
     		 , users_code 
     		 )
		VALUES 
			( #{prodPlanCode}
			, #{prodPlanCode}
			, #{prodReqCode}
			, #{planDate}
			, #{prodPlanStatus}
			, #{usersCode}
			)
	</insert>
		<insert id="insertProdPlanDetail" parameterType="ProdPlanDeVO">
		INSERT INTO prod_plan_detail
			( PROD_PLAN_DETAIL_CODE
     		 , PROD_PLAN_CODE
     		 , PROD_REQ_DETAIL_CODE
     		 , PRODUCT_CODE
     		 , FIX_CNT
     		 , REQ_CNT
     		 , PLAN_CNT
     		 , NOT_INSTRUCT_CNT
     		 , INSTRUCT_DONE_CNT 
     		 )
		VALUES 
			( #{prodPlanDetailCode}
			, #{prodPlanCode}
			, #{prodReqDetailCode}
			, #{productCode}
			, #{fixCnt}
			, #{reqCnt}
			, #{planCnt}
			, #{notInstructCnt}
			, #{instructDoneCnt}
			)
	</insert>
	
  	


	
</mapper>