<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.production.mapper.ProdPlanMapper">

<!-- 생산요청 -->
	<select id="getProdReq" resultType="ProdPlanBVO">
		SELECT req_date 
		     , prod_req_code
		     , total_req_cnt
		     , users_code
		FROM prod_req
		WHERE req_date BETWEEN SYSDATE - 8 AND SYSDATE
	</select>

<!-- 생산요청상세 -->	
	<select id="getProdReqDetail" resultType="ProdPlanBDeVO">
		SELECT prod_req_code
		     , prd.prod_req_detail_code
		     , prd.product_code
         , p.product_name
		     , prd.req_cnt
		FROM prod_req_detail prd JOIN product p
                              ON prd.product_code = p.product_code
		WHERE prod_req_code = #{prodReqCode}
	</select>
	
	
<!-- 생산계획 -->
	<select id="getProdPlan" resultType="ProdPlanVO">
		SELECT prod_plan_code
     		 , prod_req_code
     		 , plan_date
     		 , prod_plan_status
     		 , users_code
		FROM prod_plan
		ORDER BY 1
	</select>

	<select id="getProdPlanAll" resultType="ProdPlanAllVO" parameterType="String">
		SELECT d.prod_plan_detail_code
		     , p.prod_plan_code
		     , d.prod_req_detail_code
		     , d.product_code
		     , d.fix_cnt
		     , d.req_cnt
		     , d.plan_cnt
		     , d.not_instruct_cnt
		     , d.instruct_done_cnt
		FROM prod_plan p JOIN prod_plan_detail d
		                    ON p.prod_plan_code = d.prod_plan_code
		WHERE p.prod_plan_code = #{prodPlanCode}
		ORDER BY 1
	</select>

	<!-- 생산계획등록 1건에 -->
	<insert id="insertProdPlan" parameterType="ProdPlanVO">
		<selectKey keyProperty="prodPlanCode"
				   order="BEFORE"
				   resultType="String">
		 SELECT seq_func('prod_plan') FROM dual
		</selectKey>
		INSERT INTO prod_plan
			( prod_plan_code
     		 , prod_req_code
     		 , plan_date
     		 , prod_plan_status
     		 , users_code 
     		 )
		VALUES 
			( #{prodPlanCode}
			, #{prodReqCode}
			, #{planDate}
			, 'LS1'
			, #{usersCode}
			)
	</insert>
	<!-- 생산상세계획등록 여러 건 -->
	<insert id="insertProdPlanDetail" parameterType="ProdPlanDeVO">
		<selectKey keyProperty="prodPlanDetailCode"
				   order="BEFORE"
				   resultType="String">
		 SELECT seq_func('prod_plan_detail') FROM dual
		</selectKey>
		INSERT INTO prod_plan_detail
			( PROD_PLAN_DETAIL_CODE
     		 , PROD_PLAN_CODE
     		 , PROD_REQ_DETAIL_CODE
     		 , PRODUCT_CODE
     		 , FIX_CNT
     		 , REQ_CNT
     		 , PLAN_CNT
     		 , NOT_INSTRUCT_CNT
     		 , INSTRUCT_DONE_CNT 
     		 )
		VALUES 
			( #{prodPlanDetailCode}
			, #{prodPlanCode}
			, #{prodReqDetailCode}
			, #{productCode}
			, #{fixCnt}
			, #{reqCnt}
			, #{fixCnt} + #{reqCnt}
			, #{fixCnt} + #{reqCnt}
			, 0
			)
	</insert>

	
  	


	
</mapper>