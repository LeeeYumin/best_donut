<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.orders.mapper.OrdersMapper">
		
	<!-- 주문목록 조회 -->
	<select id="getOrders" resultType="Map">
		SELECT o.orders_code
			   , o.orders_date
			   , o.due_date
			   , o.total_orders_price
			   , o.orders_status
			   , c.company_name
			   , u.users_name
		  FROM orders o 
		  JOIN company c ON o.company_code = c.company_code
		  JOIN USERS u   ON o.users_code = u.users_code
		<where>
			<if test="ordersCode != null and ordersCode != ''">
				orders_code LIKE '%' || #{ordersCode} || '%'
			</if>
		</where> 
		 ORDER BY 1
	</select>
	
	<!-- 주문상세목록 조회 -->
	<select id="getOrdersDetail" resultType="OrdersDetailVO" parameterType="String">
		SELECT d.orders_detail_code
		       , d.orders_cnt
			   , d.supply_price
			   , d.tax
			   , d.total_supply_price
			   , d.orders_code
			   , d.product_code
			   , p.product_name
		  FROM orders_detail d 
		  JOIN product p ON d.product_code = p.product_code
		 WHERE d.orders_code = #{ordersCode}
		 ORDER BY 1
	</select>
	
	<!-- 주문 등록 -->
	<insert id="insertOrders" parameterType="OrdersVO">
		INSERT INTO orders
			(
				orders_code
				, orders_date
				, due_date
				, total_orders_price
				, orders_status
				, users_code
				, company_code
			)
		VALUES 
			(
				#{ordersCode}
				, #{ordersDate}
				, #{dueDate}
				, #{totalOrdersPrice}
				, #{ordersStatus}
				, #{usersCode}
				, #{companyCode}
			)			
	</insert>
</mapper>